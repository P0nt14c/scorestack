<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Small Architecture - Scorestack Documentation</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../checks.html"><strong aria-hidden="true">1.</strong> Checks</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../checks/adding_checks.html"><strong aria-hidden="true">1.1.</strong> Adding Checks</a></li><li class="chapter-item expanded "><a href="../checks/check_json.html"><strong aria-hidden="true">1.2.</strong> check.json</a></li><li class="chapter-item expanded "><a href="../checks/attributes.html"><strong aria-hidden="true">1.3.</strong> Attributes</a></li><li class="chapter-item expanded "><a href="../checks/adding_teams.html"><strong aria-hidden="true">1.4.</strong> Adding Teams</a></li><li class="chapter-item expanded "><a href="../checks/updating.html"><strong aria-hidden="true">1.5.</strong> Updating Checks</a></li></ol></li><li class="chapter-item expanded "><a href="../reference.html"><strong aria-hidden="true">2.</strong> Check Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/dns.html"><strong aria-hidden="true">2.1.</strong> DNS</a></li><li class="chapter-item expanded "><a href="../reference/ftp.html"><strong aria-hidden="true">2.2.</strong> FTP</a></li><li class="chapter-item expanded "><a href="../reference/http.html"><strong aria-hidden="true">2.3.</strong> HTTP</a></li><li class="chapter-item expanded "><a href="../reference/icmp.html"><strong aria-hidden="true">2.4.</strong> ICMP</a></li><li class="chapter-item expanded "><a href="../reference/imap.html"><strong aria-hidden="true">2.5.</strong> IMAP</a></li><li class="chapter-item expanded "><a href="../reference/ldap.html"><strong aria-hidden="true">2.6.</strong> LDAP</a></li><li class="chapter-item expanded "><a href="../reference/mysql.html"><strong aria-hidden="true">2.7.</strong> MySQL</a></li><li class="chapter-item expanded "><a href="../reference/noop.html"><strong aria-hidden="true">2.8.</strong> Noop</a></li><li class="chapter-item expanded "><a href="../reference/smb.html"><strong aria-hidden="true">2.9.</strong> SMB</a></li><li class="chapter-item expanded "><a href="../reference/smtp.html"><strong aria-hidden="true">2.10.</strong> SMTP</a></li><li class="chapter-item expanded "><a href="../reference/ssh.html"><strong aria-hidden="true">2.11.</strong> SSH</a></li><li class="chapter-item expanded "><a href="../reference/vnc.html"><strong aria-hidden="true">2.12.</strong> VNC</a></li><li class="chapter-item expanded "><a href="../reference/winrm.html"><strong aria-hidden="true">2.13.</strong> WinRM</a></li><li class="chapter-item expanded "><a href="../reference/xmpp.html"><strong aria-hidden="true">2.14.</strong> XMPP</a></li></ol></li><li class="chapter-item expanded "><a href="../deployment.html"><strong aria-hidden="true">3.</strong> Deployment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../deployment/binaries.html"><strong aria-hidden="true">3.1.</strong> Obtaining Binaries</a></li><li class="chapter-item expanded "><a href="../deployment/cloning.html"><strong aria-hidden="true">3.2.</strong> Cloning the Repository</a></li><li class="chapter-item expanded "><a href="../deployment/small.html" class="active"><strong aria-hidden="true">3.3.</strong> Small Architecture</a></li><li class="chapter-item expanded "><a href="../deployment/medium.html"><strong aria-hidden="true">3.4.</strong> Medium Architecture</a></li><li class="chapter-item expanded "><a href="../deployment/dynamicbeat.html"><strong aria-hidden="true">3.5.</strong> Dynamicbeat</a></li></ol></li><li class="chapter-item expanded "><a href="../design.html"><strong aria-hidden="true">4.</strong> Design</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../design/architecture.html"><strong aria-hidden="true">4.1.</strong> Elastic Stack Architecture</a></li><li class="chapter-item expanded "><a href="../design/permissions.html"><strong aria-hidden="true">4.2.</strong> User Roles</a></li><li class="chapter-item expanded "><a href="../design/check.html"><strong aria-hidden="true">4.3.</strong> Life of a Check</a></li></ol></li><li class="chapter-item expanded "><a href="../building.html"><strong aria-hidden="true">5.</strong> Building Binaries</a></li><li class="chapter-item expanded "><a href="../appendix/faq.html"><strong aria-hidden="true">6.</strong> Appendix A - FAQ</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Appendix B - Glossary</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Appendix C - Developer Processes</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="../contributors.html">Contributors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Scorestack Documentation</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#small-architecture" id="small-architecture">Small Architecture</a></h1>
<p>This architecture deploys three hosts:</p>
<ul>
<li><code>elasticsearch</code>: A single-node Elasticsearch cluster</li>
<li><code>kibana</code>: The Kibana server</li>
<li><code>logstash</code>: The Logstash server</li>
</ul>
<h2><a class="header" href="#docker-deployment" id="docker-deployment">Docker Deployment</a></h2>
<p>The Small architecture can deployed on a single system using Docker. Before deploying with Docker, you must make sure that <code>docker</code>, <code>docker-compose</code>, and <code>git</code> are installed on your system. Then, <a href="cloning.html">clone the Scorestack repository</a> to the host you plan to use for running Scorestack.</p>
<h3><a class="header" href="#deploying" id="deploying">Deploying</a></h3>
<p>First, change into the Scorestack repository directory.</p>
<pre><code class="language-shell">cd scorestack
</code></pre>
<p>Next, you need to increase the maximum number of memory map areas that a single process can use. This is required for Elasticsearch to function properly. If you forget to configure this setting, Elasticsearch will appear to start properly, but crash and exit before the APIs are available. This setting is configured via <code>sysctl</code> on Linux hosts.</p>
<p>You can change this setting immediately with a <code>sysctl</code> command.</p>
<pre><code class="language-shell">sudo sysctl -w vm.max_map_count=262144
</code></pre>
<p>Please note the changes made by the above command will not persist on reboot. In order to persistently make these changes, add the <code>vm.max_map_count</code> setting to your <code>/etc/sysctl.conf</code> file, or to a file under the <code>/etc/sysctl.d</code> directory. The proper location for these changes depends on your distribution.</p>
<p>Now run <code>docker-compose</code> to deploy Scorestack. Make sure to include the <code>-d</code> parameter!</p>
<pre><code class="language-shell">sudo docker-compose -f deployment/small/docker/docker-compose.yml up -d
</code></pre>
<p>Once all the containers have started, you can check on the progress of the deployment by following the logs of the setup container. You can do so with another <code>docker-compose</code> command.</p>
<pre><code class="language-shell">sudo docker-compose -f deployment/small/docker/docker-compose.yml logs -f setup
</code></pre>
<p>If it looks like the setup container is getting hung up on waiting for Elasticsearch or Kibana, give it two to three minutes before troubleshooting. Sometimes it can take a while for these components to get ready. If it's still trying to connect after a few minutes have passed, check the logs for the Elasticsearch and Kibana containers to see what's wrong.</p>
<p>Once the setup container has exited, Scorestack is fully deployed and ready to use!</p>
<h3><a class="header" href="#dynamicbeat-certificates" id="dynamicbeat-certificates">Dynamicbeat Certificates</a></h3>
<p>To deploy Dynamicbeat, you will need the Dynamicbeat client certificate and key and the Scorestack internal CA certificate. Once the deployment has finished, these files can be found at the following paths within the repository:</p>
<ul>
<li><code>deployment/small/docker/certificates/dynamicbeat/dynamicbeat.key</code></li>
<li><code>deployment/small/docker/certificates/dynamicbeat/dynamicbeat.crt</code></li>
<li><code>deployment/small/docker/certificates/ca/ca.crt</code></li>
</ul>
<p>See the <a href="dynamicbeat.html">Dynamicbeat deployment guide</a> for more information.</p>
<h3><a class="header" href="#cleanupteardown" id="cleanupteardown">Cleanup/Teardown</a></h3>
<p>If you just want to stop Scorestack and restart it later, you can do so with normal <code>docker-compose</code> commands.</p>
<pre><code class="language-shell">sudo docker-compose -f deployment/small/docker/docker-compose.yml down
sudo docker-compose -f deployment/small/docker/docker-compose.yml up -d
</code></pre>
<blockquote>
<p>If you restart Scorestack, the <code>setup</code> container will also be restarted, and that's okay. It shouldn't make any changes to your cluster.</p>
</blockquote>
<p>To destroy the Scorestack cluster completely and remove all artifacts, you must stop and remove the containers, remove the volumes, and delete the certificates from disk.</p>
<pre><code class="language-shell">sudo docker-compose -f deployment/small/docker/docker-compose.yml down -v
rm -rf deployment/small/docker/certificates
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../deployment/cloning.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../deployment/medium.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../deployment/cloning.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../deployment/medium.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
